{% extends "base.html" %}

{% block content %}
<div class="card" style="display: flex; gap: 20px;">

    <!-- Sidebar: lista de ramais -->
    <div style="width: 30%; border-right: 1px solid #ccc; padding-right: 10px;">
        <h3>Ramais Cadastrados</h3>
        {% if ramais %}
            <ul id="lista-ramais" style="list-style: none; padding: 0;">
                {% for r in ramais %}
                    <li style="padding: 5px; cursor: pointer; border-bottom: 1px solid #eee;"
                        onclick="selecionarRamal('{{ r.ramal }}', '{{ r.nome }}', '{{ r.senha }}', '{{ r.contexto }}')">
                        {{ r.ramal }} - {{ r.nome }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Nenhum ramal cadastrado.</p>
        {% endif %}
    </div>

    <!-- Formulário central -->
    <div style="flex-grow: 1; padding-left: 10px;">
        <h2 id="form-title">Cadastro de Ramal</h2>

        {% if mensagem %}
            <p style="color: green;">{{ mensagem }}</p>
        {% endif %}
        {% if erro %}
            <p style="color: red;">{{ erro }}</p>
        {% endif %}

        <form method="POST" id="form-ramal">
            <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label for="ramal">Ramal:</label><br>
                    <input type="number" name="ramal" id="ramal" required style="width: 100%;">
                </div>
                <div style="flex: 2;">
                    <label for="nome">Nome do Ramal:</label><br>
                    <input type="text" name="nome" id="nome" required style="width: 100%;">
                </div>
            </div>

            <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label for="senha">Senha:</label><br>
                    <input type="text" name="senha" id="senha" required style="width: 100%;">
                </div>
                <div style="flex: 2;">
                    <label for="contexto">Contexto:</label><br>
                    <select id="contexto" name="contexto" style="width: 100%;">
                        <option value="portaria" {% if ramal.contexto == "portaria" %}selected{% endif %}>Portaria</option>
                        <option value="entrada" {% if ramal.contexto == "entrada" %}selected{% endif %}>Entrada</option>
                    </select>
                </div>
            </div>

            <div style="margin-top: 10px;">
                <button type="submit">Salvar Ramal</button>
                <button type="button" style="margin-left: 10px; background-color: #e0e0e0; color: #000;"
                        onclick="resetForm()">Reset</button>
                <button type="button" style="margin-left: 10px; background-color: red; color: white;"
                        onclick="excluirRamal()">Excluir Ramal</button>
            </div>
        </form>

    </div>
</div>

<script>
function selecionarRamal(numero, nome, senha, contexto) {
    const ramalInput = document.getElementById("ramal");
    ramalInput.value = numero;
    ramalInput.readOnly = true; // muda de disabled para readonly
    document.getElementById("nome").value = nome;
    document.getElementById("senha").value = senha || "";
    document.getElementById("contexto").value = contexto;
    document.getElementById("form-title").innerText = "Editar Ramal";
}

function resetForm() {
    document.getElementById("form-ramal").reset();
    document.getElementById("ramal").readOnly = false;
    document.getElementById("form-title").innerText = "Cadastro de Ramal";
}

function excluirRamal() {
    const ramal = document.getElementById("ramal").value;
    if (!ramal) {
        alert("Selecione um ramal para excluir.");
        return;
    }

    if (confirm(`Tem certeza que deseja excluir o ramal ${ramal}?`)) {
        // Cria um formulário temporário para enviar POST
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "/cadastro/ramal/excluir";

        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "ramal";
        input.value = ramal;
        form.appendChild(input);

        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}

